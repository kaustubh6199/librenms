machine:
  timezone:
    Europe/Rome
  php:
    version: 5.6.5

dependencies:
  pre:
    - sudo apt-get update
    - sudo apt-get install nginx
    - wget https://s3.amazonaws.com/influxdb/influxdb_latest_amd64.deb
    - sudo useradd influxdb
    - sudo dpkg -i influxdb_latest_amd64.deb
    - sudo cp ./scripts/influxdb_conf.toml /etc/opt/influxdb/influxdb.conf
    - sudo /opt/influxdb/influxd -config /etc/opt/influxdb/influxdb.conf: {background: true}
    - sudo cp scripts/nginx_proxy.conf /etc/nginx/conf.d/proxy.conf
    - sudo service nginx restart
test:
  override:
    - vendor/bin/phpunit --coverage-clover clover.xml
  post:
    - wget https://scrutinizer-ci.com/ocular.phar
    - php ocular.phar code-coverage:upload --format=php-clover clover.xml
